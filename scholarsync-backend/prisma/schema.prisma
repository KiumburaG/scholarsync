// Simplified Prisma Schema for ScholarSync - Matches Resolver Code

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER AUTHENTICATION & PROFILES
// ============================================

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String   @map("password_hash")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  profile       UserProfile?
  applications  Application[]
  essays        Essay[]

  @@map("users")
}

model UserProfile {
  id        String   @id @default(uuid())
  userId    String   @unique @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Basic Info
  firstName String?  @map("first_name")
  lastName  String?  @map("last_name")
  phone     String?
  dateOfBirth DateTime? @map("date_of_birth")

  // Address
  streetAddress String? @map("street_address")
  city          String?
  state         String?
  zip           String?
  country       String? @default("United States")

  // Academic Info
  currentSchool     String?  @map("current_school")
  graduationYear    Int?     @map("graduation_year")
  major             String?
  minor             String?
  gpa               Float?
  academicStanding  String?  @map("academic_standing")

  // Demographics
  citizenship     String?
  ethnicity       String?
  gender          String?
  firstGeneration Boolean? @map("first_generation")

  // Profile Narrative
  background      String?  @db.Text
  challenges      String?  @db.Text
  academicJourney String?  @db.Text @map("academic_journey")
  careerGoals     String?  @db.Text @map("career_goals")
  whyEducation    String?  @db.Text @map("why_education")
  personalValues  String?  @db.Text @map("personal_values")

  // Preferences
  preferredScholarshipTypes String[] @default([]) @map("preferred_scholarship_types")

  // Metadata
  profileStrength Int @default(0) @map("profile_strength")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  activities Activity[]

  @@map("user_profiles")
}

model Activity {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  userProfileId String  @map("user_profile_id")
  userProfile  UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade)

  type         String
  organization String?
  role         String?
  description  String?  @db.Text
  startDate    DateTime? @map("start_date")
  endDate      DateTime? @map("end_date")
  isCurrent    Boolean @default(false) @map("is_current")
  hoursPerWeek Int?     @map("hours_per_week")
  achievements String[] @default([])

  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("activities")
}

// ============================================
// SCHOLARSHIPS
// ============================================

model Scholarship {
  id           String   @id @default(uuid())

  // Basic Info
  title        String   @db.VarChar(500)
  organization String?
  amount       Int
  deadline     DateTime
  description  String?  @db.Text

  // Eligibility
  eligibilityRequirements Json @map("eligibility_requirements")

  // Application
  applicationUrl String   @map("application_url") @db.Text
  essayPrompts   Json     @map("essay_prompts")

  // Categories
  tags         String[] @default([])

  // Status
  isActive     Boolean @default(true) @map("is_active")
  source       String  @default("manual")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  applications Application[]

  @@map("scholarships")
}

// ============================================
// APPLICATIONS
// ============================================

model Application {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  scholarshipId String   @map("scholarship_id")
  scholarship   Scholarship @relation(fields: [scholarshipId], references: [id], onDelete: Cascade)

  // Status
  status            String
  progressPercentage Int @default(0) @map("progress_percentage")
  deadline          DateTime

  // Dates
  submittedAt DateTime? @map("submitted_at")

  // Outcome
  amountAwarded Int? @map("amount_awarded")

  // Notes
  notes String? @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  essays Essay[]
  documents Document[]

  @@unique([userId, scholarshipId])
  @@map("applications")
}

model Essay {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  applicationId String?  @map("application_id")
  application   Application? @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  promptText     String   @db.Text @map("prompt_text")
  wordLimit      Int?     @map("word_limit")
  generatedEssay String?  @db.Text @map("generated_essay")
  finalEssay     String?  @db.Text @map("final_essay")
  wordCount      Int?     @map("word_count")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("essays")
}

model Document {
  id            String   @id @default(uuid())
  applicationId String   @map("application_id")
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  name     String
  type     String
  filename String
  fileUrl  String   @map("file_url") @db.Text
  fileSize Int?     @map("file_size")

  uploadedAt DateTime @default(now()) @map("uploaded_at")

  @@map("documents")
}

// ============================================
// MATCH SCORES (For Caching)
// ============================================

model MatchScore {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  scholarshipId String   @map("scholarship_id")

  score         Int
  eligibilityStatus String @map("eligibility_status")
  missingRequirements String[] @default([]) @map("missing_requirements")

  // Match factors
  gpaMatch              Float @map("gpa_match")
  majorMatch            Float @map("major_match")
  deadlineProximity     Float @map("deadline_proximity")
  profileStrength       Float @map("profile_strength")
  activityMatch         Float @map("activity_match")
  academicStandingMatch Float @map("academic_standing_match")

  calculatedAt DateTime @default(now()) @map("calculated_at")

  @@unique([userId, scholarshipId])
  @@map("match_scores")
}
